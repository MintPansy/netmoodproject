<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NetMood Analyzer - ë„¤íŠ¸ì›Œí¬ ê°ì • ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f8f0;
      min-height: 100vh;
      color: #333;
    }

    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 2.5rem;
      background: linear-gradient(45deg, #667eea, #764ba2);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      color: #666;
    }

    .upload-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .upload-area {
      border: 3px dashed #ddd;
      border-radius: 15px;
      padding: 40px;
      margin: 20px 0;
      transition: all 0.3s ease;
      cursor: pointer;
      background: #f9f9f9;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #f0f2ff;
    }

    .upload-area.dragover {
      border-color: #667eea;
      background: #e8ecff;
    }

    .file-input {
      display: none;
    }

    .upload-btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .upload-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .analysis-status {
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
      font-weight: 500;
      animation: pulse 2s infinite;
    }

    .status-processing {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .status-complete {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      animation: none;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }

      100% {
        opacity: 1;
      }
    }

    .mood-overview {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .section-title {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: #333;
      text-align: center;
    }

    .mood-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .mood-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      transform-style: preserve-3d;
    }

    .mood-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .mood-card.calm {
      background: linear-gradient(135deg, #56ab2f, #a8e6cf);
    }

    .mood-card.happy {
      background: linear-gradient(135deg, #74b9ff, #a29bfe);
    }

    .mood-card.anxious {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
    }

    .mood-card.angry {
      background: linear-gradient(135deg, #e84393, #fd79a8);
    }

    .mood-emoji {
      font-size: 3rem;
      display: block;
      margin-bottom: 15px;
    }

    .mood-name {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 10px;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .mood-value {
      font-size: 3rem;
      font-weight: bold;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .mood-percentage {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      opacity: 0.8;
    }

    .chart-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .chart-title {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: #333;
      text-align: center;
    }

    .chart-container canvas {
      height: 100px;
      width: 100%;
      border-radius: 10px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .time-filter-buttons {
      display: flex;
      gap: 8px;
      background: rgba(255, 255, 255, 0.8);
      padding: 8px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .time-filter-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background: transparent;
      color: #666;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .time-filter-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      transform: translateY(-1px);
    }

    .time-filter-btn.active {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .chart-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .chart-info {
      display: flex;
      gap: 20px;
      font-size: 0.9rem;
      color: #666;
    }

    .chart-info span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .chart-legend {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .legend-color.calm {
      background: linear-gradient(45deg, #28a745, #20c997);
    }

    .legend-color.happy {
      background: linear-gradient(45deg, #17a2b8, #20c997);
    }

    .legend-color.anxious {
      background: linear-gradient(45deg, #ffc107, #fd7e14);
    }

    .legend-color.angry {
      background: linear-gradient(45deg, #dc3545, #e83e8c);
    }

    /* ì°¨íŠ¸ ì¸í„°ë™ì…˜ ìŠ¤íƒ€ì¼ */
    .chart-container:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .chart-container {
      transition: all 0.3s ease;
    }

    /* B2C ì¹œí™”ì  ë©”ì¸ ìƒíƒœ í‘œì‹œ */
    .main-mood-status {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .current-mood-display {
      margin-bottom: 30px;
    }

    .primary-mood {
      margin-bottom: 30px;
    }

    .mood-emoji-large {
      font-size: 8rem;
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }

    .mood-status-text {
      font-size: 2rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
    }

    .mood-confidence {
      font-size: 1.2rem;
      color: #666;
      background: rgba(102, 126, 234, 0.1);
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
    }

    .quick-stats {
      display: flex;
      justify-content: space-around;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .stat-item {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 15px;
      min-width: 120px;
    }

    .stat-label {
      display: block;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 8px;
    }

    .stat-value {
      display: block;
      font-size: 2rem;
      font-weight: bold;
      color: #333;
    }

    .stat-unit {
      font-size: 0.8rem;
      color: #999;
      margin-left: 4px;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 15px 30px;
      border: none;
      border-radius: 25px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 180px;
    }

    .action-btn.primary {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
    }

    .action-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .action-btn.secondary {
      background: rgba(255, 255, 255, 0.8);
      color: #667eea;
      border: 2px solid #667eea;
    }

    .action-btn.secondary:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    /* ê°ì • ìš”ì•½ ì¹´ë“œ */
    .emotion-summary {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .emotion-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .emotion-card {
      display: flex;
      align-items: center;
      padding: 15px;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .emotion-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .emotion-card.calm {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }

    .emotion-card.happy {
      background: linear-gradient(135deg, #17a2b8, #20c997);
      color: white;
    }

    .emotion-card.anxious {
      background: linear-gradient(135deg, #ffc107, #fd7e14);
      color: white;
    }

    .emotion-card.angry {
      background: linear-gradient(135deg, #dc3545, #e83e8c);
      color: white;
    }

    .emotion-card.sad {
      background: linear-gradient(135deg, #6f42c1, #e83e8c);
      color: white;
    }

    .emotion-icon {
      font-size: 2rem;
      margin-right: 15px;
    }

    .emotion-info {
      flex: 1;
    }

    .emotion-name {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .emotion-count {
      font-size: 1.5rem;
      font-weight: bold;
    }

    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      max-width: 1200px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 25px 30px;
      border-bottom: 1px solid #eee;
    }

    .modal-header h2 {
      margin: 0;
      color: #333;
      font-size: 1.8rem;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 2rem;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      background: #f5f5f5;
      color: #333;
    }

    .modal-body {
      padding: 30px;
    }

    .advanced-chart-section {
      margin-bottom: 30px;
    }

    .chart-controls {
      display: flex;
      flex-direction: column;
      gap: 25px;
      margin-bottom: 25px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
    }

    .time-filter-group,
    .emotion-toggle-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .time-filter-group label,
    .emotion-toggle-group label {
      font-weight: 600;
      color: #333;
      font-size: 1rem;
    }

    .emotion-toggles {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .emotion-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .emotion-toggle:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    .emotion-toggle input[type="checkbox"] {
      display: none;
    }

    .toggle-indicator {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid #ddd;
      transition: all 0.3s ease;
    }

    .emotion-toggle input:checked+.toggle-indicator {
      border-color: #333;
    }

    .toggle-indicator.calm {
      background: #28a745;
    }

    .toggle-indicator.happy {
      background: #17a2b8;
    }

    .toggle-indicator.anxious {
      background: #ffc107;
    }

    .toggle-indicator.angry {
      background: #dc3545;
    }

    .toggle-indicator.sad {
      background: #6f42c1;
    }

    .advanced-chart-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .advanced-chart-container canvas {
      height: 400px;
      width: 100%;
    }

    .chart-info {
      display: flex;
      gap: 30px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .info-item {
      text-align: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 10px;
      min-width: 150px;
    }

    .info-label {
      display: block;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
    }

    .alerts-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .alert {
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      font-weight: 500;
      animation: slideIn 0.5s ease-out;
      border-left: 5px solid;
    }

    .alert-danger {
      background: #f8d7da;
      color: #721c24;
      border-left-color: #dc3545;
    }

    .alert-warning {
      background: #fff3cd;
      color: #856404;
      border-left-color: #ffc107;
    }

    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border-left-color: #17a2b8;
    }

    .summary-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .summary-title {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: #333;
      text-align: center;
    }

    .summary-text {
      font-size: 1.1rem;
      line-height: 1.7;
      color: #555;
      text-align: center;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      border-left: 5px solid #667eea;
    }

    .hidden {
      display: none;
    }

    .fade-in {
      animation: fadeIn 0.8s ease-out forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(-50px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .drag-text {
      font-size: 1.2rem;
      color: #666;
      margin-bottom: 20px;
    }

    .upload-icon {
      font-size: 4rem;
      color: #ccc;
      margin-bottom: 20px;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      .dashboard {
        padding: 10px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .mood-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .mood-card {
        padding: 20px;
      }

      .mood-emoji {
        font-size: 2.5rem;
      }

      .mood-value {
        font-size: 2.5rem;
      }

      .chart-header {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
      }

      .time-filter-buttons {
        justify-content: center;
        flex-wrap: wrap;
      }

      .chart-controls {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      .chart-info {
        justify-content: center;
        flex-direction: column;
        gap: 10px;
      }

      .chart-legend {
        justify-content: center;
      }

      .chart-container canvas {
        height: 350px;
      }
    }

    @media (max-width: 480px) {
      .time-filter-buttons {
        gap: 4px;
      }

      .time-filter-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
      }

      .chart-container canvas {
        height: 300px;
      }

      .legend-item {
        font-size: 0.8rem;
      }

      .legend-color {
        width: 10px;
        height: 10px;
      }

      /* B2C ëª¨ë°”ì¼ ìµœì í™” */
      .mood-emoji-large {
        font-size: 5rem;
      }

      .mood-status-text {
        font-size: 1.5rem;
      }

      .quick-stats {
        flex-direction: column;
        gap: 15px;
      }

      .stat-item {
        min-width: auto;
      }

      .action-buttons {
        flex-direction: column;
        align-items: center;
      }

      .action-btn {
        min-width: auto;
        width: 100%;
        max-width: 250px;
      }

      .emotion-cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .emotion-card {
        padding: 12px;
      }

      .emotion-icon {
        font-size: 1.5rem;
        margin-right: 10px;
      }

      .emotion-name {
        font-size: 0.9rem;
      }

      .emotion-count {
        font-size: 1.2rem;
      }

      /* ëª¨ë‹¬ ëª¨ë°”ì¼ ìµœì í™” */
      .modal-content {
        margin: 10px;
        max-height: 95vh;
      }

      .modal-header {
        padding: 20px;
      }

      .modal-header h2 {
        font-size: 1.5rem;
      }

      .modal-body {
        padding: 20px;
      }

      .chart-controls {
        gap: 15px;
        padding: 15px;
      }

      .emotion-toggles {
        gap: 10px;
      }

      .emotion-toggle {
        padding: 6px 8px;
        font-size: 0.9rem;
      }

      .advanced-chart-container canvas {
        height: 300px;
      }

      .chart-info {
        flex-direction: column;
        gap: 15px;
      }

      .info-item {
        min-width: auto;
      }
    }
  </style>
</head>

<body>
  <div class="dashboard">
    <!-- í—¤ë” -->
    <header class="header">
      <h1>ğŸ§  NetMood Analyzer</h1>
      <p>ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ê°ì •ìœ¼ë¡œ ë¶„ì„í•˜ëŠ” AI ëŒ€ì‹œë³´ë“œ</p>
    </header>

    <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
    <section class="upload-section">
      <h2 class="section-title">ğŸ“ ë°ì´í„° ì—…ë¡œë“œ</h2>
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">ğŸ“„</div>
        <div class="drag-text">
          CSV íŒŒì¼ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ê±°ë‚˜ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
        </div>
        <input type="file" id="csvFile" class="file-input" accept=".csv">
        <button class="upload-btn" onclick="document.getElementById('csvFile').click()">
          ğŸ“‚ íŒŒì¼ ì„ íƒ
        </button>
        <button class="upload-btn demo-btn" onclick="runSampleAnalysis()"
          style="margin-left: 10px; background: linear-gradient(45deg, #28a745, #20c997);">
          ğŸ¯ ìƒ˜í”Œ ë°ì´í„°ë¡œ ë°ëª¨
        </button>
      </div>
      <div id="analysisStatus" class="analysis-status"></div>
    </section>

    <!-- B2C ì¹œí™”ì  ë©”ì¸ ê°ì • ìƒíƒœ í‘œì‹œ -->
    <section class="main-mood-status hidden" id="mainMoodSection">
      <div class="current-mood-display">
        <div class="primary-mood" id="primaryMood">
          <div class="mood-emoji-large" id="primaryEmoji">ğŸ˜Œ</div>
          <div class="mood-status-text" id="primaryStatusText">ë„¤íŠ¸ì›Œí¬ê°€ í‰ì˜¨í•œ ìƒíƒœì…ë‹ˆë‹¤</div>
          <div class="mood-confidence" id="moodConfidence">ì‹ ë¢°ë„: 85%</div>
        </div>

        <div class="quick-stats">
          <div class="stat-item">
            <span class="stat-label">ì „ì²´ ë¶„ì„</span>
            <span class="stat-value" id="totalRecords">0</span>
            <span class="stat-unit">ê±´</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">ì•ˆì „ë„</span>
            <span class="stat-value" id="safetyScore">0</span>
            <span class="stat-unit">%</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</span>
            <span class="stat-value" id="lastUpdate">-</span>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="action-btn primary" onclick="showDetailView()">
          ğŸ“Š ìƒì„¸ ë¶„ì„ ë³´ê¸°
        </button>
        <button class="action-btn secondary" onclick="exportReport()">
          ğŸ“„ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
        </button>
      </div>
    </section>

    <!-- ê°„ë‹¨í•œ ê°ì • ìš”ì•½ ì¹´ë“œ -->
    <section class="emotion-summary hidden" id="emotionSummarySection">
      <h3 class="summary-title">ğŸ’­ ê°ì •ë³„ ìš”ì•½</h3>
      <div class="emotion-cards" id="emotionCards">
        <div class="emotion-card calm">
          <div class="emotion-icon">ğŸ˜Œ</div>
          <div class="emotion-info">
            <div class="emotion-name">í‰ì˜¨</div>
            <div class="emotion-count" id="calmCount">0</div>
          </div>
        </div>
        <div class="emotion-card happy">
          <div class="emotion-icon">ğŸ˜Š</div>
          <div class="emotion-info">
            <div class="emotion-name">ê¸°ì¨</div>
            <div class="emotion-count" id="happyCount">0</div>
          </div>
        </div>
        <div class="emotion-card anxious">
          <div class="emotion-icon">ğŸ˜°</div>
          <div class="emotion-info">
            <div class="emotion-name">ë¶ˆì•ˆ</div>
            <div class="emotion-count" id="anxiousCount">0</div>
          </div>
        </div>
        <div class="emotion-card angry">
          <div class="emotion-icon">ğŸ˜¡</div>
          <div class="emotion-info">
            <div class="emotion-name">í™”ë‚¨</div>
            <div class="emotion-count" id="angryCount">0</div>
          </div>
        </div>
        <div class="emotion-card sad">
          <div class="emotion-icon">ğŸ˜¢</div>
          <div class="emotion-info">
            <div class="emotion-name">ìŠ¬í””</div>
            <div class="emotion-count" id="sadCount">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ê°ì • ë³€í™” ì¶”ì´ ì°¨íŠ¸ -->
    <div class="chart-container hidden fade-in" id="chartSection">
      <div class="chart-header">
        <h3 class="chart-title">ğŸ“ˆ ê°ì • ë³€í™” ì¶”ì´</h3>
        <div class="time-filter-buttons">
          <button class="time-filter-btn active" data-period="3h">3ì‹œê°„</button>
          <button class="time-filter-btn" data-period="1d">1ì¼</button>
          <button class="time-filter-btn" data-period="1m">1ë‹¬</button>
          <button class="time-filter-btn" data-period="3m">3ë‹¬</button>
        </div>
      </div>
      <div class="chart-controls">
        <div class="chart-info">
          <span id="chartInfo">ì´ ë°ì´í„° í¬ì¸íŠ¸: <strong id="dataPointCount">0</strong>ê°œ</span>
          <span id="timeRange">ì‹œê°„ ë²”ìœ„: <strong id="timeRangeText">-</strong></span>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-color calm"></div>
            <span>í‰ì˜¨</span>
          </div>
          <div class="legend-item">
            <div class="legend-color happy"></div>
            <span>ê¸°ì¨</span>
          </div>
          <div class="legend-item">
            <div class="legend-color anxious"></div>
            <span>ë¶ˆì•ˆ</span>
          </div>
          <div class="legend-item">
            <div class="legend-color angry"></div>
            <span>í™”ë‚¨</span>
          </div>
        </div>
      </div>
      <canvas id="moodChart"></canvas>
    </div>

    <!-- ì•Œë¦¼ ì„¹ì…˜ -->
    <div class="alerts-section hidden fade-in" id="alertsSection">
      <h3 style="margin-bottom: 20px; color: #333; font-size: 1.3rem;">ğŸš¨ ê°ì • ì•Œë¦¼</h3>
      <div id="alertContainer"></div>
    </div>

    <!-- ìš”ì•½ ì„¹ì…˜ -->
    <div class="summary-section hidden fade-in" id="summarySection">
      <h3 class="summary-title">ğŸ“‹ ë¶„ì„ ê²°ê³¼ ìš”ì•½</h3>
      <p class="summary-text" id="summaryText">
        ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ë©´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì˜ ê°ì • íŒ¨í„´ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>
    </section>
  </div>

  <!-- ìƒì„¸ ë¶„ì„ ëª¨ë‹¬ -->
  <div class="modal-overlay hidden" id="detailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“Š ìƒì„¸ ê°ì • ë¶„ì„</h2>
        <button class="close-btn" onclick="hideDetailView()">&times;</button>
      </div>

      <div class="modal-body">
        <!-- ê³ ê¸‰ ì°¨íŠ¸ ì„¹ì…˜ -->
        <div class="advanced-chart-section">
          <div class="chart-controls">
            <div class="time-filter-group">
              <label>ì‹œê°„ ë‹¨ìœ„:</label>
              <div class="time-filter-buttons">
                <button class="time-filter-btn active" data-period="1d">1ì¼</button>
                <button class="time-filter-btn" data-period="1m">1ë‹¬</button>
                <button class="time-filter-btn" data-period="3m">3ë‹¬</button>
              </div>
            </div>

            <div class="emotion-toggle-group">
              <label>ê°ì • ì„ íƒ:</label>
              <div class="emotion-toggles">
                <label class="emotion-toggle">
                  <input type="checkbox" checked data-emotion="calm">
                  <span class="toggle-indicator calm"></span>
                  <span>í‰ì˜¨</span>
                </label>
                <label class="emotion-toggle">
                  <input type="checkbox" checked data-emotion="happy">
                  <span class="toggle-indicator happy"></span>
                  <span>ê¸°ì¨</span>
                </label>
                <label class="emotion-toggle">
                  <input type="checkbox" checked data-emotion="anxious">
                  <span class="toggle-indicator anxious"></span>
                  <span>ë¶ˆì•ˆ</span>
                </label>
                <label class="emotion-toggle">
                  <input type="checkbox" checked data-emotion="angry">
                  <span class="toggle-indicator angry"></span>
                  <span>í™”ë‚¨</span>
                </label>
                <label class="emotion-toggle">
                  <input type="checkbox" checked data-emotion="sad">
                  <span class="toggle-indicator sad"></span>
                  <span>ìŠ¬í””</span>
                </label>
              </div>
            </div>
          </div>

          <div class="advanced-chart-container">
            <canvas id="advancedMoodChart"></canvas>
          </div>

          <div class="chart-info">
            <div class="info-item">
              <span class="info-label">ë°ì´í„° í¬ì¸íŠ¸:</span>
              <span class="info-value" id="advancedDataPoints">0</span>
            </div>
            <div class="info-item">
              <span class="info-label">ì‹œê°„ ë²”ìœ„:</span>
              <span class="info-value" id="advancedTimeRange">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let moodChart;

    // 5ê°€ì§€ ê°ì •ì„ í¬í•¨í•œ ìƒ˜í”Œ CSV ë°ì´í„°
    const sampleCSVData = `Timestamp,SourceIP,DestinationIP,Protocol,Bytes,PacketRate,ProtocolEntropy,Emotion
2025-10-03 10:00:00,192.168.0.1,8.8.8.8,TCP,23456,120,0.62,í‰ì˜¨
2025-10-03 10:01:00,192.168.0.2,10.0.0.5,UDP,34000,780,0.85,í™”ë‚¨
2025-10-03 10:02:00,192.168.0.3,1.1.1.1,ICMP,4500,40,0.55,ê¸°ì¨
2025-10-03 10:03:00,192.168.0.3,8.8.4.4,TCP,17000,500,0.75,ë¶ˆì•ˆ
2025-10-03 10:04:00,192.168.0.4,20.1.1.2,TCP,20000,230,0.68,í‰ì˜¨
2025-10-03 10:05:00,192.168.0.5,8.8.8.8,TCP,15000,180,0.45,í‰ì˜¨
2025-10-03 10:06:00,192.168.0.6,10.0.0.1,UDP,50000,920,0.92,í™”ë‚¨
2025-10-03 10:07:00,192.168.0.7,1.1.1.1,TCP,28000,350,0.58,ê¸°ì¨
2025-10-03 10:08:00,192.168.0.8,8.8.4.4,ICMP,8000,60,0.42,í‰ì˜¨
2025-10-03 10:09:00,192.168.0.9,20.1.1.2,TCP,32000,480,0.78,ë¶ˆì•ˆ
2025-10-03 10:10:00,192.168.0.10,8.8.8.8,TCP,12000,90,0.35,ìŠ¬í””
2025-10-03 10:11:00,192.168.0.11,10.0.0.1,UDP,25000,650,0.88,í™”ë‚¨
2025-10-03 10:12:00,192.168.0.12,1.1.1.1,ICMP,3000,25,0.28,ê¸°ì¨
2025-10-03 10:13:00,192.168.0.13,8.8.4.4,TCP,18000,420,0.72,ë¶ˆì•ˆ
2025-10-03 10:14:00,192.168.0.14,20.1.1.2,TCP,22000,380,0.65,ìŠ¬í””`;

    // CSV ë°ì´í„° íŒŒì‹± í•¨ìˆ˜
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',');
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',');
        const row = {};

        headers.forEach((header, index) => {
          let value = values[index];

          // ìˆ«ì íƒ€ì… ë³€í™˜
          if (header === 'Bytes' || header === 'PacketRate') {
            value = parseInt(value);
          } else if (header === 'ProtocolEntropy') {
            value = parseFloat(value);
          }

          row[header.trim()] = value;
        });

        data.push(row);
      }

      return data;
    }

    // 5ê°€ì§€ ê°ì •ë³„ íŠ¸ë˜í”½ ë¶„ì„ í•¨ìˆ˜
    function analyzeEmotionTraffic(csvData) {
      const emotionStats = {
        'í‰ì˜¨': { count: 0, totalBytes: 0, totalPackets: 0, avgEntropy: 0, protocols: {} },
        'ê¸°ì¨': { count: 0, totalBytes: 0, totalPackets: 0, avgEntropy: 0, protocols: {} },
        'ë¶ˆì•ˆ': { count: 0, totalBytes: 0, totalPackets: 0, avgEntropy: 0, protocols: {} },
        'í™”ë‚¨': { count: 0, totalBytes: 0, totalPackets: 0, avgEntropy: 0, protocols: {} },
        'ìŠ¬í””': { count: 0, totalBytes: 0, totalPackets: 0, avgEntropy: 0, protocols: {} }
      };

      csvData.forEach(row => {
        const emotion = row.Emotion;
        if (emotionStats[emotion]) {
          emotionStats[emotion].count++;
          emotionStats[emotion].totalBytes += row.Bytes;
          emotionStats[emotion].totalPackets += row.PacketRate;
          emotionStats[emotion].avgEntropy += row.ProtocolEntropy;

          // í”„ë¡œí† ì½œë³„ í†µê³„
          const protocol = row.Protocol;
          emotionStats[emotion].protocols[protocol] = (emotionStats[emotion].protocols[protocol] || 0) + 1;
        }
      });

      // í‰ê·  ê³„ì‚°
      Object.keys(emotionStats).forEach(emotion => {
        if (emotionStats[emotion].count > 0) {
          emotionStats[emotion].avgEntropy /= emotionStats[emotion].count;
        }
      });

      return emotionStats;
    }

    // 5ê°€ì§€ ê°ì •ë³„ ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜
    function calculateEmotionPercentages(emotionStats) {
      const total = Object.values(emotionStats).reduce((sum, stat) => sum + stat.count, 0);

      return {
        calm: total > 0 ? Math.round((emotionStats['í‰ì˜¨'].count / total) * 100) : 0,
        happy: total > 0 ? Math.round((emotionStats['ê¸°ì¨'].count / total) * 100) : 0,
        anxious: total > 0 ? Math.round((emotionStats['ë¶ˆì•ˆ'].count / total) * 100) : 0,
        angry: total > 0 ? Math.round((emotionStats['í™”ë‚¨'].count / total) * 100) : 0,
        sad: total > 0 ? Math.round((emotionStats['ìŠ¬í””'].count / total) * 100) : 0
      };
    }

    // ê³ ê¸‰ ì‹œê°„ë³„ ê°ì • ë³€í™” ë°ì´í„° ìƒì„±
    function generateAdvancedTimeSeriesFromCSV(csvData, timePeriod = '3h') {
      const labels = [];
      const datasets = {
        calm: [],
        happy: [],
        anxious: [],
        angry: [],
        sad: []
      };

      // ì‹œê°„ ê·¸ë£¹í™” í•¨ìˆ˜
      function groupByTimePeriod(data, period) {
        const groups = {};

        data.forEach(row => {
          const date = new Date(row.Timestamp);
          let groupKey;

          switch (period) {
            case '3h':
              // 3ì‹œê°„ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™” (ë¶„ ë‹¨ìœ„)
              groupKey = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
              break;
            case '1d':
              // 1ì¼ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™” (ì‹œê°„ ë‹¨ìœ„)
              groupKey = `${date.getHours().toString().padStart(2, '0')}:00`;
              break;
            case '1m':
              // 1ë‹¬ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™” (ì¼ ë‹¨ìœ„)
              groupKey = `${date.getMonth() + 1}/${date.getDate()}`;
              break;
            case '3m':
              // 3ë‹¬ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™” (ì£¼ ë‹¨ìœ„)
              const weekNumber = Math.ceil(date.getDate() / 7);
              groupKey = `${date.getMonth() + 1}ì›” ${weekNumber}ì£¼`;
              break;
            default:
              groupKey = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
          }

          if (!groups[groupKey]) {
            groups[groupKey] = { 'í‰ì˜¨': 0, 'ê¸°ì¨': 0, 'ë¶ˆì•ˆ': 0, 'í™”ë‚¨': 0, 'ìŠ¬í””': 0 };
          }
          groups[groupKey][row.Emotion]++;
        });

        return groups;
      }

      // ìƒ˜í”Œ ë°ì´í„° í™•ì¥ (ë” ë§ì€ ë°ì´í„° í¬ì¸íŠ¸ ìƒì„±)
      const extendedData = extendSampleData(csvData, timePeriod);
      const timeGroups = groupByTimePeriod(extendedData, timePeriod);

      // ì •ë ¬ëœ ì‹œê°„ ë¼ë²¨ ìƒì„±
      const sortedTimes = Object.keys(timeGroups).sort((a, b) => {
        if (timePeriod === '3h' || timePeriod === '1d') {
          return a.localeCompare(b);
        } else if (timePeriod === '1m') {
          const [monthA, dayA] = a.split('/');
          const [monthB, dayB] = b.split('/');
          return monthA - monthB || dayA - dayB;
        } else {
          return a.localeCompare(b);
        }
      });

      sortedTimes.forEach(time => {
        labels.push(time);
        datasets.calm.push(timeGroups[time]['í‰ì˜¨']);
        datasets.happy.push(timeGroups[time]['ê¸°ì¨']);
        datasets.anxious.push(timeGroups[time]['ë¶ˆì•ˆ']);
        datasets.angry.push(timeGroups[time]['í™”ë‚¨']);
        datasets.sad.push(timeGroups[time]['ìŠ¬í””']);
      });

      return {
        labels,
        datasets,
        totalPoints: sortedTimes.length,
        timeRange: {
          start: sortedTimes[0] || '',
          end: sortedTimes[sortedTimes.length - 1] || ''
        }
      };
    }

    // ìƒ˜í”Œ ë°ì´í„° í™•ì¥ í•¨ìˆ˜ (ë” ë§ì€ ë°ì´í„° í¬ì¸íŠ¸ ìƒì„±)
    function extendSampleData(csvData, timePeriod) {
      const extendedData = [...csvData];
      const baseDate = new Date(csvData[0].Timestamp);

      // ì‹œê°„ëŒ€ë³„ë¡œ ë” ë§ì€ ë°ì´í„° ìƒì„±
      let multiplier = 1;
      switch (timePeriod) {
        case '1d': multiplier = 24; break;
        case '1m': multiplier = 30; break;
        case '3m': multiplier = 90; break;
        default: multiplier = 10;
      }

      for (let i = 0; i < multiplier; i++) {
        csvData.forEach(row => {
          const newRow = { ...row };
          const newDate = new Date(row.Timestamp);

          switch (timePeriod) {
            case '1d':
              newDate.setHours(newDate.getHours() + i);
              break;
            case '1m':
              newDate.setDate(newDate.getDate() + i);
              break;
            case '3m':
              newDate.setDate(newDate.getDate() + i * 3);
              break;
            default:
              newDate.setMinutes(newDate.getMinutes() + i * 30);
          }

          newRow.Timestamp = newDate.toISOString().replace('T', ' ').substring(0, 19);

          // ê°ì • ê°’ì— ì•½ê°„ì˜ ë³€ë™ ì¶”ê°€
          const emotions = ['í‰ì˜¨', 'ê¸°ì¨', 'ë¶ˆì•ˆ', 'í™”ë‚¨', 'ìŠ¬í””'];
          const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
          newRow.Emotion = Math.random() < 0.7 ? row.Emotion : randomEmotion;

          extendedData.push(newRow);
        });
      }

      return extendedData;
    }

    // ì „ì—­ ë³€ìˆ˜ë¡œ CSV ë°ì´í„° ì €ì¥
    let globalCSVData = null;

    // ì‹¤ì œ CSV ë°ì´í„°ë¡œ ë¶„ì„ ìˆ˜í–‰
    function performRealAnalysis(csvText) {
      const csvData = parseCSV(csvText);
      globalCSVData = csvData; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥

      const emotionStats = analyzeEmotionTraffic(csvData);
      const emotionPercentages = calculateEmotionPercentages(emotionStats);
      const timeSeriesData = generateAdvancedTimeSeriesFromCSV(csvData, '3h');

      return {
        csvData,
        emotionStats,
        emotionPercentages,
        timeSeriesData
      };
    }

    // ì‹œê°„ í•„í„° ë³€ê²½ ì‹œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateChartByTimePeriod(timePeriod) {
      if (!globalCSVData) return;

      const timeSeriesData = generateAdvancedTimeSeriesFromCSV(globalCSVData, timePeriod);
      createAdvancedMoodChart(timeSeriesData, timePeriod);
    }

    // ê³ ê¸‰ ì°¨íŠ¸ ì‹œê°„ í•„í„° ì—…ë°ì´íŠ¸
    function updateAdvancedChartByTimePeriod(timePeriod) {
      if (!globalCSVData) return;

      const timeSeriesData = generateAdvancedTimeSeriesFromCSV(globalCSVData, timePeriod);
      createAdvancedMoodChart(timeSeriesData, timePeriod);
    }

    // ê°ì •ë³„ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
    function updateEmotionVisibility(emotion, isVisible) {
      if (!moodChart) return;

      const emotionIndex = {
        'calm': 0,
        'happy': 1,
        'anxious': 2,
        'angry': 3,
        'sad': 4
      };

      const datasetIndex = emotionIndex[emotion];
      if (datasetIndex !== undefined) {
        moodChart.setDatasetVisibility(datasetIndex, isVisible);
        moodChart.update();
      }
    }

    // B2C ì¹œí™”ì  ë©”ì¸ í™”ë©´ ì—…ë°ì´íŠ¸
    function updateMainMoodDisplay(analysisResult) {
      const { emotionPercentages, emotionStats, csvData } = analysisResult;

      // ì£¼ìš” ê°ì • ê²°ì •
      const dominantEmotion = Object.keys(emotionPercentages).reduce((a, b) =>
        emotionPercentages[a] > emotionPercentages[b] ? a : b
      );

      // ê°ì •ë³„ ì´ëª¨ì§€ì™€ ë©”ì‹œì§€ ë§¤í•‘
      const emotionConfig = {
        calm: { emoji: 'ğŸ˜Œ', message: 'ë„¤íŠ¸ì›Œí¬ê°€ í‰ì˜¨í•œ ìƒíƒœì…ë‹ˆë‹¤', color: '#28a745' },
        happy: { emoji: 'ğŸ˜Š', message: 'ë„¤íŠ¸ì›Œí¬ê°€ í™œë°œí•˜ê³  ê±´ê°•í•©ë‹ˆë‹¤', color: '#17a2b8' },
        anxious: { emoji: 'ğŸ˜°', message: 'ë„¤íŠ¸ì›Œí¬ì— ë¶ˆì•ˆí•œ íŒ¨í„´ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤', color: '#ffc107' },
        angry: { emoji: 'ğŸ˜¡', message: 'ë„¤íŠ¸ì›Œí¬ì— ìœ„í—˜í•œ íŒ¨í„´ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤', color: '#dc3545' },
        sad: { emoji: 'ğŸ˜¢', message: 'ë„¤íŠ¸ì›Œí¬ í™œë™ì´ ì €ì¡°í•œ ìƒíƒœì…ë‹ˆë‹¤', color: '#6f42c1' }
      };

      const config = emotionConfig[dominantEmotion];

      // ë©”ì¸ ê°ì • í‘œì‹œ ì—…ë°ì´íŠ¸
      document.getElementById('primaryEmoji').textContent = config.emoji;
      document.getElementById('primaryStatusText').textContent = config.message;
      document.getElementById('primaryEmoji').style.color = config.color;

      // ì‹ ë¢°ë„ ê³„ì‚° (ê°€ì¥ ë†’ì€ ê°ì •ì˜ ë¹„ìœ¨)
      const confidence = emotionPercentages[dominantEmotion];
      document.getElementById('moodConfidence').textContent = `ì‹ ë¢°ë„: ${confidence}%`;

      // ë¹ ë¥¸ í†µê³„ ì—…ë°ì´íŠ¸
      document.getElementById('totalRecords').textContent = csvData.length;

      // ì•ˆì „ë„ ê³„ì‚° (í‰ì˜¨ + ê¸°ì¨ ë¹„ìœ¨)
      const safetyScore = emotionPercentages.calm + emotionPercentages.happy;
      document.getElementById('safetyScore').textContent = safetyScore;

      // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
      const now = new Date();
      document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('ko-KR');

      // ê°ì •ë³„ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
      document.getElementById('calmCount').textContent = emotionStats['í‰ì˜¨'].count;
      document.getElementById('happyCount').textContent = emotionStats['ê¸°ì¨'].count;
      document.getElementById('anxiousCount').textContent = emotionStats['ë¶ˆì•ˆ'].count;
      document.getElementById('angryCount').textContent = emotionStats['í™”ë‚¨'].count;
      document.getElementById('sadCount').textContent = emotionStats['ìŠ¬í””'].count;

      // ê°ì • ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜
      const emotionCards = document.querySelectorAll('.emotion-card');
      emotionCards.forEach((card, index) => {
        setTimeout(() => {
          card.style.transform = 'scale(1.05)';
          setTimeout(() => {
            card.style.transform = 'scale(1)';
          }, 200);
        }, index * 100);
      });
    }

    // ëª¨ë‹¬ í‘œì‹œ/ìˆ¨ê¸°ê¸° í•¨ìˆ˜
    function showDetailView() {
      const modal = document.getElementById('detailModal');
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // ìƒì„¸ ì°¨íŠ¸ ìƒì„±
      if (globalCSVData) {
        createAdvancedMoodChart(generateAdvancedTimeSeriesFromCSV(globalCSVData, '1d'), '1d');
      }
    }

    function hideDetailView() {
      const modal = document.getElementById('detailModal');
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    // ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    function exportReport() {
      if (!globalCSVData) {
        alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const analysisResult = performRealAnalysis(sampleCSVData);
      const reportData = {
        timestamp: new Date().toISOString(),
        totalRecords: analysisResult.csvData.length,
        emotionPercentages: analysisResult.emotionPercentages,
        emotionStats: analysisResult.emotionStats,
        summary: analysisResult.summary
      };

      const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `netmood-report-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ê³ ê¸‰ ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜ (5ê°€ì§€ ê°ì • + í† ê¸€ ê¸°ëŠ¥)
    function createAdvancedMoodChart(timeSeriesData, timePeriod = '1d') {
      const ctx = document.getElementById('advancedMoodChart').getContext('2d');

      if (moodChart) {
        moodChart.destroy();
      }

      // ì‹œê°„ ë‹¨ìœ„ë³„ Xì¶• ë¼ë²¨ ì„¤ì •
      const xAxisTitle = getTimeAxisTitle(timePeriod);

      moodChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeSeriesData.labels,
          datasets: [
            {
              label: 'í‰ì˜¨ ğŸ˜Œ',
              data: timeSeriesData.datasets.calm,
              borderColor: '#28a745',
              backgroundColor: 'rgba(40, 167, 69, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: '#28a745',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointHoverBackgroundColor: '#28a745',
              pointHoverBorderColor: '#ffffff',
              pointHoverBorderWidth: 3,
              tension: 0.4,
              fill: true,
              spanGaps: false
            },
            {
              label: 'ê¸°ì¨ ğŸ˜Š',
              data: timeSeriesData.datasets.happy,
              borderColor: '#17a2b8',
              backgroundColor: 'rgba(23, 162, 184, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: '#17a2b8',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointHoverBackgroundColor: '#17a2b8',
              pointHoverBorderColor: '#ffffff',
              pointHoverBorderWidth: 3,
              tension: 0.4,
              fill: true,
              spanGaps: false
            },
            {
              label: 'ë¶ˆì•ˆ ğŸ˜°',
              data: timeSeriesData.datasets.anxious,
              borderColor: '#ffc107',
              backgroundColor: 'rgba(255, 193, 7, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: '#ffc107',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointHoverBackgroundColor: '#ffc107',
              pointHoverBorderColor: '#ffffff',
              pointHoverBorderWidth: 3,
              tension: 0.4,
              fill: true,
              spanGaps: false
            },
            {
              label: 'í™”ë‚¨ ğŸ˜¡',
              data: timeSeriesData.datasets.angry,
              borderColor: '#dc3545',
              backgroundColor: 'rgba(220, 53, 69, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: '#dc3545',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointHoverBackgroundColor: '#dc3545',
              pointHoverBorderColor: '#ffffff',
              pointHoverBorderWidth: 3,
              tension: 0.4,
              fill: true,
              spanGaps: false
            },
            {
              label: 'ìŠ¬í”” ğŸ˜¢',
              data: timeSeriesData.datasets.sad,
              borderColor: '#6f42c1',
              backgroundColor: 'rgba(111, 66, 193, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: '#6f42c1',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointHoverBackgroundColor: '#6f42c1',
              pointHoverBorderColor: '#ffffff',
              pointHoverBorderWidth: 3,
              tension: 0.4,
              fill: true,
              spanGaps: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            intersect: false,
            mode: 'index'
          },
          plugins: {
            legend: {
              display: false // ì»¤ìŠ¤í…€ ë²”ë¡€ ì‚¬ìš©
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              borderColor: '#667eea',
              borderWidth: 1,
              cornerRadius: 8,
              displayColors: true,
              callbacks: {
                title: function (context) {
                  return `ğŸ“… ${context[0].label}`;
                },
                label: function (context) {
                  const emotion = context.dataset.label;
                  const value = context.parsed.y;
                  return `${emotion}: ${value}ê±´`;
                }
              }
            }
          },
          scales: {
            x: {
              display: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.1)',
                lineWidth: 1
              },
              ticks: {
                color: '#666',
                font: {
                  size: 11,
                  weight: '500'
                }
              },
              title: {
                display: true,
                text: xAxisTitle,
                color: '#333',
                font: {
                  size: 12,
                  weight: '600'
                }
              }
            },
            y: {
              display: true,
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.1)',
                lineWidth: 1
              },
              ticks: {
                color: '#666',
                font: {
                  size: 11,
                  weight: '500'
                },
                callback: function (value) {
                  return value + 'ê±´';
                }
              },
              title: {
                display: true,
                text: 'ê°ì • ë°œìƒ ë¹ˆë„',
                color: '#333',
                font: {
                  size: 12,
                  weight: '600'
                }
              }
            }
          },
          animation: {
            duration: 1500,
            easing: 'easeInOutQuart',
            delay: function (context) {
              return context.dataIndex * 50;
            }
          },
          elements: {
            line: {
              tension: 0.4
            }
          }
        }
      });

      // ì°¨íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
      updateAdvancedChartInfo(timeSeriesData);
    }

    // ì‹œê°„ ë‹¨ìœ„ë³„ Xì¶• ì œëª© ë°˜í™˜
    function getTimeAxisTitle(timePeriod) {
      switch (timePeriod) {
        case '3h': return 'ì‹œê°„ (3ì‹œê°„ ë‹¨ìœ„ - ë¶„ë³„)';
        case '1d': return 'ì‹œê°„ (1ì¼ ë‹¨ìœ„ - ì‹œê°„ë³„)';
        case '1m': return 'ë‚ ì§œ (1ë‹¬ ë‹¨ìœ„ - ì¼ë³„)';
        case '3m': return 'ì£¼ì°¨ (3ë‹¬ ë‹¨ìœ„ - ì£¼ë³„)';
        default: return 'ì‹œê°„';
      }
    }

    // ì°¨íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateChartInfo(timeSeriesData) {
      document.getElementById('dataPointCount').textContent = timeSeriesData.totalPoints;
      document.getElementById('timeRangeText').textContent =
        `${timeSeriesData.timeRange.start} ~ ${timeSeriesData.timeRange.end}`;
    }

    // ê³ ê¸‰ ì°¨íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateAdvancedChartInfo(timeSeriesData) {
      document.getElementById('advancedDataPoints').textContent = timeSeriesData.totalPoints;
      document.getElementById('advancedTimeRange').textContent =
        `${timeSeriesData.timeRange.start} ~ ${timeSeriesData.timeRange.end}`;
    }

    function generateAlerts(moodData) {
      const alertContainer = document.getElementById('alertContainer');
      alertContainer.innerHTML = '';

      const alerts = [];

      // ë¶„ë…¸ ë ˆë²¨ì´ ë†’ì„ ë•Œ
      if (moodData.angry > 15) {
        alerts.push({
          type: 'danger',
          icon: 'ğŸ”¥',
          message: `ê¸´ê¸‰! ë„¤íŠ¸ì›Œí¬ ë¶„ë…¸ ë ˆë²¨ì´ ${moodData.angry}%ë¡œ ë†’ìŠµë‹ˆë‹¤. ë³´ì•ˆ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.`
        });
      }

      // ë¶ˆì•ˆ ë ˆë²¨ì´ ë†’ì„ ë•Œ
      if (moodData.anxious > 25) {
        alerts.push({
          type: 'warning',
          icon: 'âš ï¸',
          message: `ì£¼ì˜! ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆ ìˆ˜ì¤€ì´ ${moodData.anxious}%ì…ë‹ˆë‹¤. ëª¨ë‹ˆí„°ë§ì„ ê°•í™”í•˜ì„¸ìš”.`
        });
      }

      // í‰ì˜¨ ë ˆë²¨ì´ ë§¤ìš° ë†’ì„ ë•Œ
      if (moodData.calm > 60) {
        alerts.push({
          type: 'info',
          icon: 'âœ…',
          message: `ì–‘í˜¸! ë„¤íŠ¸ì›Œí¬ ìƒíƒœê°€ ì•ˆì •ì ì…ë‹ˆë‹¤. í‰ì˜¨ ìˆ˜ì¤€ì´ ${moodData.calm}%ì…ë‹ˆë‹¤.`
        });
      }

      // ì•Œë¦¼ì´ ì—†ì„ ë•Œ
      if (alerts.length === 0) {
        const normalAlert = document.createElement('div');
        normalAlert.className = 'alert alert-info';
        normalAlert.innerHTML = '<span>ğŸ“Š</span> í˜„ì¬ ëª¨ë“  ê°ì • ì§€í‘œê°€ ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤.';
        alertContainer.appendChild(normalAlert);
        return;
      }

      alerts.forEach(alert => {
        const alertElement = document.createElement('div');
        alertElement.className = `alert alert-${alert.type}`;
        alertElement.innerHTML = `<span>${alert.icon}</span>${alert.message}`;
        alertContainer.appendChild(alertElement);
      });
    }

    function generateSummary(analysisResult) {
      const summaryElement = document.getElementById('summaryText');
      const { emotionPercentages, emotionStats, csvData } = analysisResult;

      let summaryText = '';
      const dominantMood = Object.keys(emotionPercentages).reduce((a, b) =>
        emotionPercentages[a] > emotionPercentages[b] ? a : b
      );

      const totalRecords = csvData.length;
      const totalBytes = csvData.reduce((sum, row) => sum + row.Bytes, 0);
      const avgEntropy = csvData.reduce((sum, row) => sum + row.ProtocolEntropy, 0) / totalRecords;

      switch (dominantMood) {
        case 'calm':
          summaryText = `ë„¤íŠ¸ì›Œí¬ê°€ í‰ì˜¨í•œ ìƒíƒœì…ë‹ˆë‹¤. ì „ì²´ ${totalRecords}ê°œ ë ˆì½”ë“œ ì¤‘ ${emotionPercentages.calm}%ê°€ ì•ˆì •ì ì¸ íŒ¨í„´ì„ ë³´ì´ë©°, í‰ê·  ì—”íŠ¸ë¡œí”¼ ${avgEntropy.toFixed(2)}ë¡œ ì‹œìŠ¤í…œì´ ì›í™œí•˜ê²Œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.`;
          break;
        case 'happy':
          summaryText = `ë„¤íŠ¸ì›Œí¬ê°€ ê±´ì „í•œ í™œë™ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ${emotionPercentages.happy}%ì˜ íŠ¸ë˜í”½ì´ ì •ìƒì ì¸ í†µì‹  íŒ¨í„´ì„ ë‚˜íƒ€ë‚´ë©°, ì´ ${(totalBytes / 1024).toFixed(1)}KBì˜ ë°ì´í„°ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`;
          break;
        case 'anxious':
          summaryText = `ë„¤íŠ¸ì›Œí¬ì—ì„œ ë¶ˆì•ˆí•œ íŒ¨í„´ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ${emotionPercentages.anxious}%ì˜ íŠ¸ë˜í”½ì´ ë¹„ì •ìƒì ì¸ í™œë™ì„ ë³´ì´ë©°, í‰ê·  ì—”íŠ¸ë¡œí”¼ ${avgEntropy.toFixed(2)}ë¡œ ì¶”ê°€ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
          break;
        case 'angry':
          summaryText = `ê²½ê³ ! ë„¤íŠ¸ì›Œí¬ì—ì„œ ìœ„í—˜í•œ íŒ¨í„´ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ${emotionPercentages.angry}%ì˜ íŠ¸ë˜í”½ì´ ì•…ì„± í™œë™ì„ ë‚˜íƒ€ë‚´ë©°, ì¦‰ì‹œ ë³´ì•ˆ ì¡°ì¹˜ë¥¼ ì·¨í•´ì•¼ í•©ë‹ˆë‹¤.`;
          break;
      }

      // ìƒì„¸ í†µê³„ ì¶”ê°€
      summaryText += `\n\nğŸ“Š ìƒì„¸ í†µê³„:\n`;
      summaryText += `â€¢ í‰ì˜¨: ${emotionStats['í‰ì˜¨'].count}ê±´ (${emotionStats['í‰ì˜¨'].avgEntropy.toFixed(2)} avg entropy)\n`;
      summaryText += `â€¢ ê¸°ì¨: ${emotionStats['ê¸°ì¨'].count}ê±´ (${emotionStats['ê¸°ì¨'].avgEntropy.toFixed(2)} avg entropy)\n`;
      summaryText += `â€¢ ë¶ˆì•ˆ: ${emotionStats['ë¶ˆì•ˆ'].count}ê±´ (${emotionStats['ë¶ˆì•ˆ'].avgEntropy.toFixed(2)} avg entropy)\n`;
      summaryText += `â€¢ í™”ë‚¨: ${emotionStats['í™”ë‚¨'].count}ê±´ (${emotionStats['í™”ë‚¨'].avgEntropy.toFixed(2)} avg entropy)`;

      summaryElement.textContent = summaryText;
    }

    function simulateAnalysis() {
      const statusElement = document.getElementById('analysisStatus');

      // ë¶„ì„ ì¤‘ ìƒíƒœ
      statusElement.className = 'analysis-status status-processing';
      statusElement.innerHTML = 'ğŸ”„ CSV íŒŒì¼ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
      statusElement.style.display = 'block';

      setTimeout(() => {
        // ë¶„ì„ ì™„ë£Œ
        statusElement.className = 'analysis-status status-complete';
        statusElement.innerHTML = 'âœ… ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.';

        // ë°ì´í„° ìƒì„±
        const moodData = generateSampleData();
        const timeSeriesData = generateTimeSeriesData();

        // UI ì—…ë°ì´íŠ¸
        setTimeout(() => {
          document.getElementById('moodGrid').classList.remove('hidden');
          document.getElementById('chartSection').classList.remove('hidden');
          document.getElementById('alertsSection').classList.remove('hidden');
          document.getElementById('summarySection').classList.remove('hidden');

          updateMoodCards(moodData);
          createMoodChart(timeSeriesData);
          generateAlerts(moodData);
          generateSummary(moodData);

          // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
          setTimeout(() => {
            statusElement.style.display = 'none';
          }, 3000);
        }, 500);

      }, 3000);
    }

    function analyzeCSVData(csvText) {
      const statusElement = document.getElementById('analysisStatus');

      // ë¶„ì„ ì¤‘ ìƒíƒœ
      statusElement.className = 'analysis-status status-processing';
      statusElement.innerHTML = 'ğŸ”„ CSV ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
      statusElement.style.display = 'block';

      setTimeout(() => {
        try {
          // ì‹¤ì œ CSV ë°ì´í„° ë¶„ì„ ìˆ˜í–‰
          const analysisResult = performRealAnalysis(csvText);

          // ë¶„ì„ ì™„ë£Œ
          statusElement.className = 'analysis-status status-complete';
          statusElement.innerHTML = 'âœ… ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.';

          // UI ì—…ë°ì´íŠ¸
          setTimeout(() => {
            // B2C ì¹œí™”ì  ë©”ì¸ í™”ë©´ í‘œì‹œ
            document.getElementById('mainMoodSection').classList.remove('hidden');
            document.getElementById('emotionSummarySection').classList.remove('hidden');
            document.getElementById('alertsSection').classList.remove('hidden');
            document.getElementById('summarySection').classList.remove('hidden');

            updateMainMoodDisplay(analysisResult);
            generateAlerts(analysisResult.emotionPercentages);
            generateSummary(analysisResult);

            // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
              statusElement.style.display = 'none';
            }, 3000);
          }, 500);

        } catch (error) {
          console.error('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
          statusElement.className = 'analysis-status status-error';
          statusElement.innerHTML = 'âŒ CSV ë°ì´í„° ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        }

      }, 2000);
    }

    function uploadFile() {
      const fileInput = document.getElementById('csvFile');
      const file = fileInput.files[0];

      if (file && file.type === 'text/csv') {
        console.log('íŒŒì¼ ì—…ë¡œë“œë¨:', file.name);

        const reader = new FileReader();
        reader.onload = function (e) {
          const csvText = e.target.result;
          analyzeCSVData(csvText);
        };
        reader.readAsText(file);
      } else {
        alert('CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
      }
    }

    // ìƒ˜í”Œ ë°ì´í„°ë¡œ ë°ëª¨ ì‹¤í–‰
    function runSampleAnalysis() {
      analyzeCSVData(sampleCSVData);
    }

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', function () {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('csvFile');

      uploadArea.addEventListener('dragover', function (e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', function (e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
          fileInput.files = files;
          uploadFile();
        }
      });

      // íŒŒì¼ ì…ë ¥ ë³€ê²½ ì´ë²¤íŠ¸
      fileInput.addEventListener('change', uploadFile);

      // ì‹œê°„ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
      const timeFilterButtons = document.querySelectorAll('.time-filter-btn');
      timeFilterButtons.forEach(button => {
        button.addEventListener('click', function () {
          // ëª¨ë“  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
          timeFilterButtons.forEach(btn => btn.classList.remove('active'));

          // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
          this.classList.add('active');

          // ì„ íƒëœ ì‹œê°„ ë‹¨ìœ„ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
          const timePeriod = this.getAttribute('data-period');
          updateAdvancedChartByTimePeriod(timePeriod);

          // ë²„íŠ¼ í´ë¦­ ì• ë‹ˆë©”ì´ì…˜
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = 'scale(1)';
          }, 150);
        });
      });

      // ê°ì • í† ê¸€ ì´ë²¤íŠ¸
      const emotionToggles = document.querySelectorAll('.emotion-toggle input[type="checkbox"]');
      emotionToggles.forEach(toggle => {
        toggle.addEventListener('change', function () {
          const emotion = this.getAttribute('data-emotion');
          const isVisible = this.checked;
          updateEmotionVisibility(emotion, isVisible);
        });
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì• ë‹ˆë©”ì´ì…˜
      const dashboard = document.querySelector('.dashboard');
      dashboard.style.opacity = '0';
      dashboard.style.transform = 'translateY(30px)';

      setTimeout(() => {
        dashboard.style.transition = 'all 0.8s ease-out';
        dashboard.style.opacity = '1';
        dashboard.style.transform = 'translateY(0)';
      }, 100);
    });
  </script>
</body>

</html>