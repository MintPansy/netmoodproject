<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NetMood Mobile</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Segoe UI, Arial;
      background: #f7fafc;
      margin: 0;
      padding: 16px
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      max-width: 520px;
      margin: 0 auto
    }

    .big-emoji {
      font-size: 64px;
      text-align: center
    }

    .big-label {
      text-align: center;
      font-weight: 700;
      margin-top: 8px
    }

    .small-msg {
      text-align: center;
      color: #666;
      margin-top: 6px
    }

    .actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 12px
    }

    .btn {
      padding: 10px 14px;
      border-radius: 8px;
      border: 0;
      background: #27d3b2;
      color: white;
      font-weight: 700
    }

    input[type=file] {
      display: none
    }

    canvas {
      max-width: 100%;
      height: 200px
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="big-emoji" id="emoji">ğŸ˜</div>
    <div class="big-label" id="label">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div class="small-msg" id="advice">ì—…ë¡œë“œë¡œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ ë¶„ì„í•˜ì„¸ìš”.</div>

    <div style="text-align:center;margin-top:12px">
      <input type="file" id="file" accept=".csv,.pcap">
      <label for="file" class="btn">íŒŒì¼ ì—…ë¡œë“œ</label>
    </div>

    <div style="margin-top:14px">
      <canvas id="chart"></canvas>
    </div>
  </div>

  <script>
    const emojiMap = {
      joy: 'ğŸ˜Š',
      stress: 'ğŸ˜°',
      calm: 'ğŸ˜Œ',
      anger: 'ğŸ˜¡',
      anxiety: 'ğŸ˜Ÿ'
    };

    let chart;
    document.getElementById('file').addEventListener('change', async (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const fd = new FormData(); fd.append('file', f);
      try {
        document.getElementById('label').textContent = 'ë¶„ì„ ì¤‘...';
        const res = await fetch('/upload.php', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('Server error');
        const data = await res.json();
        if (!data.success) throw new Error(data.error || 'ë¶„ì„ ì‹¤íŒ¨');

        // top emotion
        const emoEntries = Object.entries(data.emotions).sort((a, b) => b[1] - a[1]);
        const top = emoEntries[0][0];
        document.getElementById('emoji').textContent = emojiMap[top] || 'ğŸ˜';
        document.getElementById('label').textContent = top.toUpperCase();
        document.getElementById('advice').textContent = data.advice?.message || '';

        // chart
        const ctx = document.getElementById('chart').getContext('2d');
        const labels = data.chartData.labels;
        const values = data.chartData.data;
        const colors = data.chartData.colors;
        if (chart) chart.destroy();
        chart = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ data: values, backgroundColor: colors }] }, options: { responsive: true, plugins: { legend: { display: false } } } });
      } catch (err) {
        document.getElementById('label').textContent = 'ì˜¤ë¥˜';
        document.getElementById('advice').textContent = err.message;
      }
    });
  </script>
</body>

</html>